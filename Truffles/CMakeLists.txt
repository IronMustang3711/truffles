#This cmake script is intended to work on projects already generated by eclipse.

#ide notes
#CLion : for deploying to work, make sure the generation path in cmake settings points to ./Debug
#XCode : creating an xcode project works, but building from within the ide doesnt :-(
# mkdir xcode && cd xcode && cmake -G Xcode ..
#other: maybe try -DCMAKE_EXPORT_COMPILE_COMMANDS=1 with ninja/makefile builds?

cmake_minimum_required(VERSION 2.8)
set(ARM_PREFIX arm-frc-linux-gnueabi)
set(CMAKE_SYSTEM_NAME Linux)

SET(CMAKE_CXX_COMPILER ${ARM_PREFIX}-g++)
SET(CMAKE_C_COMPILER ${ARM_PREFIX}-gcc)
set(CMAKE_CXX_FLAGS "-Wno-unknown-warning-option -std=c++1y -Wformat=2 -Wall -Wextra -Werror -pedantic -Wno-psabi" CACHE STRING "" FORCE)
set(CMAKE_CXX_FLAGS_DEBUG "-O0 -g3" CACHE STRING "" FORCE)
set(CMAKE_CXX_FLAGS_RELEASE "-O3 -g" CACHE STRING "" FORCE) # still want debugging for release?

get_filename_component(PROJECT_NAME ${CMAKE_CURRENT_SOURCE_DIR} NAME)
project(${PROJECT_NAME})



set(WPI_DIR "$ENV{HOME}/wpilib")

include_directories(
        "${WPI_DIR}/cpp/current/include"
        "${WPI_DIR}/user/cpp/include")
link_directories(
        "${WPI_DIR}/cpp/current/lib"
        "${WPI_DIR}/user/cpp/lib")







#from eclipse:
#gcc: -O0 -g3 -Wall -c -fmessage-length=0
#g++: -std=c++1y -I"/Users/jason/wpilib/cpp/current/include" -I"/Users/jason/Documents/workspace/Truffles/src" -O0 -g3 -Wall -c -fmessage-length=0
#linker: -L"/Users/jason/wpilib/cpp/current/lib" -Wl,-rpath,/opt/GenICam_v2_3/bin/Linux_armv7-a,-rpath,/usr/local/frc/rpath-lib


set(CMAKE_INSTALL_RPATH "/opt/GenICam_v2_3/bin/Linux_armv7-a" "/usr/local/frc/rpath-lib")



file(GLOB_RECURSE SOURCE_FILES src/*.cpp)





#add_executable(${PROJECT_NAME} ${SOURCE_FILES})
#target_link_libraries(${PROJECT_NAME} wpi)

add_executable(FRCUserProgram ${SOURCE_FILES})
target_link_libraries(FRCUserProgram CTRLib navx_frc_cpp  wpi) #TODO add additional libs here


add_custom_target("deploy"
        COMMAND ant -f ${CMAKE_CURRENT_SOURCE_DIR}/build.xml
        DEPENDS FRCUserProgram)